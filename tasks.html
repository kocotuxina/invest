<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пример заголовка</title>
    <style>
        body {
            color: #000000;
            background: #76bdff; 
        }
        h1 {
            color: #000000;
        }
        #ball h2 {
            color: #ff2c72;
        }
        #ball {
            background: #c5b0b0;
        }
        #img h2 {
            color: #ff2cca;
        }
        #img {
            background: #bef5f0;
        }
        #zvonki h2 {
            color: #cc7b96;
        }
        #zvonki {
            background: #b8e290;
        }
        #task h2 {
            color: #2cff6b;
        }
        #task {
            background: #c7a7eb;
        }
        #diary h2 {
            color: #ff2ced;
        }
        #diary {
            background: linear-gradient(#ffc6a0,#ff8a3b);
        }
        #buhgalterya h2 {
            color: #000000;
        }
        #buhgalterya {
            background: #abccfd;
        }
        img {
            width: 50%;
        }
        .strong {
            font-weight: bold;
        }
        .italic {
            font-style: italic;
        }
        .strike {
            text-decoration: line-through;
        }
        table, td {
            border: 1px solid black;
        }
        table {
            border-collapse: collapse;
            text-align: center;
        }
        td {
            padding: 5px;
        }
        #wrapper {
            font-size: 13px;
        }
        #wrapper table, #wrapper tr, #wrapper th, #wrapper td{
            border: 1px black solid;
            padding: 3px;
        }
        .vacation {
            background-color: aquamarine;
        }
    </style>
</head>
<body>
    <h1>Моя первая страница</h1>
    <div id="ball">
        <h2 class="odd">
            Мячик
        </h2>
        <b>Наша Таня громко плачет:</b><br>
        <i>Уронила в речку мячик.</i><br>
        -Тише, Танечка, не плачь:<br>
        <strike>Не утонет в речке мяч.</strike><br>
        <i><b>Автор: А. Л. Барто</b></i><br>

        <p class="strong">То же самое, только на CSS:</p>

        <span class="strong">Наша Таня громко плачет:</span><br>
        <span class="italic">Уронила в речку мячик.</span><br>
        <span>-Тише, Танечка, не плачь:</span><br>
        <span class="strike">Не утонет в речке мяч.</span><br>
        <span class="strong italic">Автор: А. Л. Барто</span>
    </div>
    <div id="img">
        <h2 class="odd">
            Весёлые картинки
        </h2>
        <img src="img/bad.jpg" alt="Веселые картинки"><br>
        <img src="img/fullhd.jpg" alt="Карандаш"><br>
        <img src="img/vertical.jpg" alt="Котик">
    </div>
    <div id="zvonki">
        <h2 class="odd">
            Расписание звонков
        </h2>
        <ol>
            <li>
                08:20 - 09:50
            </li>
            <li>
                10:00 - 11:30
                <ul>
                    <li>Перемена 40 мин</li>
                </ul>
            </li>
            <li>
                12:10 - 13:40
            </li>
            <li>
                13:50 - 15:20
            </li>
            <li>
                15:30 - 17:00
                <ul>
                    <li>Перемена 20 минут</li>
                </ul>
            </li>
            <li>
                17:20 - 18:50
            </li>
            <li>
                19:00 - 20:30
            </li>
        </ol>
    </div>
    <div id="task">
        <h2 class="odd">
            Расписание пар
        </h2>
        <table>
            <thead>
                <tr>
                    <td>Номер пары</td>
                    <td>Название предмета</td>
                    <td>Аудитория</td>
                    <td>Преподаватель</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Методы оптимизации</td>
                    <td>223</td>
                    <td>Банников А.С.</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Численные методы</td>
                    <td>219</td>
                    <td>Латыпова Н.В.</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Методы оптимизации</td>
                    <td>219</td>
                    <td>Петров Н.Н.</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Параллельное программирование</td>
                    <td>217</td>
                    <td>Новиков А.К.</td>
                </tr>
            </tbody>
        </table>
    </div>
    <div id="diary">
        <h2 class="odd">
            Дневник
        </h2>
        <form action="" method="post">
            <div>
                <p><b>ФИО</b></p>
                <p>
                <input type="text" name="fio" value="Косотухина Татьяна Алексеевна">
                </p>
            </div>
            <div>
                <p><b>Пол</b></p>
                <p>
                    <input name="pol" type="radio" value="male">
                    Мужской
                </p>
                <p>
                    <input name="pol" type="radio" value="female" checked>
                    Женский
                </p>
            </div>
            <div>
                <p><b>Школа</b></p>
                <p>
                <input type="text" name="school" value="СОШ №1">
                </p>
            </div>
            <div>
                <p><b>Населенный пункт</b></p>
                <p>
                <input type="text" name="city" value="Ижевск">
                </p>
            </div>
            <div>
                <p><b>Класс</b></p>
                <p>
                <input type="text" name="class" value="11">
                </p>
            </div>
            <div>
                <p><b>Цвет обложки</b></p>
                <p>
                    <input type="color" name="color" value="#c5b0b0">
                </p>
            </div>
            <div>
                <p><b>Год начала учебного года</b></p>
                <p>
                    <input type="number" name="year" value="2018">
                </p>
            </div>
            <div>
                <p><b>Email</b></p>
                <p>
                    <input type="email" name="email" value="tkosot2001@gmail.com">
                </p>
            </div>
            <div>
                <p><b>Телефон</b></p>
                <p>
                    <input type="tel" name="tel" value="89827920448">
                </p>
            </div>
            <div>
                <p>
                    <input type="button" id="create" value="Создать">
                </p>
            </div>
        </form>
    </div>
    <div id="buhgalterya">
        <h2 class="odd">
            Бухгалтерия
        </h2>
        <div id="wrapper"></div>
        <script>
        let employees = [
            {
                "surname": 'Иванов', //Фамилия
                "name": 'Иван', //Имя
                "patronymic": 'Иванович', //Отчество 
                "birthday": '1987-11-30', //Дата рождения в формате ГГГГ-ММ-ДД
                "experience": 5, //Стаж работы
                "salary": 48200, //Зарплата гросс в месяц
                "salary13": 3000, //Годовая премия
                "gender": 'm', //Премия
                "vacation": 0, //Месяц отпуска
            },
            {
                "surname": 'Петров', 
                "name": 'Петр', 
                "patronymic": 'Петрович', 
                "birthday": '2001-01-01',
                "experience": 0,
                "salary": 27600,
                "salary13": 1000,
                "gender": 'm',
                "vacation": 8,
            },
            {
                "surname": 'Капустина', 
                "name": 'Ирина', 
                "patronymic": 'Николаевна', 
                "birthday": '1992-02-02',
                "experience": 4,
                "salary": 36000,
                "salary13": 4000,
                "gender": 'f',
                "vacation": 3,
            },
            {
                "surname": 'Билл', 
                "name": 'Гейтс', 
                "patronymic": '', 
                "birthday": '1955-10-28',
                "experience": 1,
                "salary": 16900,
                "salary13": 100,
                "gender": 'm',
                "vacation": 11,
            },
            {
                "surname": 'Ложкина', 
                "name": 'Галина', 
                "patronymic": 'Ильинична', 
                "birthday": '2002-01-13',
                "experience": 1,
                "salary": 80000,
                "salary13": 100000,
                "gender": 'f',
                "vacation": 6,
            },
            {
                "surname": 'Матрос', 
                "name": 'Капитолия', 
                "patronymic": 'Владовна', 
                "birthday": '1975-04-20',
                "experience": 20,
                "salary": 90000,
                "salary13": 4000,
                "gender": 'f',
                "vacation": 7,
            },
            {
                "surname": 'Елисейская', 
                "name": 'Италия', 
                "patronymic": 'Франсовна', 
                "birthday": '1999-08-12',
                "experience": 3,
                "salary": 36700,
                "salary13": 4000,
                "gender": 'f',
                "vacation": 4,
            },
            {
                "surname": 'Строгая', 
                "name": 'Лада', 
                "patronymic": '', 
                "birthday": '1990-08-15',
                "experience": 7,
                "salary": 69000,
                "salary13": 3600,
                "gender": 'f',
                "vacation": 9,
            },
            {
                "surname": 'Император', 
                "name": 'Павел', 
                "patronymic": 'Григорьевич', 
                "birthday": '1970-12-19',
                "experience": 7,
                "salary": 28999,
                "salary13": 3900,
                "gender": 'm',
                "vacation": 1,
            },
            {
                "surname": 'Ватрушкин', 
                "name": 'Петр', 
                "patronymic": 'Семенович', 
                "birthday": '2000-05-13',
                "experience": 1,
                "salary": 200000,
                "salary13": 0,
                "gender": 'm',
                "vacation": 5,
            },
            ];
            function calculateNetSalary(salary){
                return +(salary*1.15*0.87).toFixed(2);
            }

            function calculateYearSalary(salary, salary13){
                return + (12*salary+0.87*salary13).toFixed(2);
            }

            function calculateTaxReturn(yearSalary){
                return Math.round(0.13*yearSalary);
            }

            function calculateNewSalary(salary){
                return +(1.078*salary).toFixed(2);
            }

            function calculateAge(birthday){
                let today = new Date();
                let age = new Date(birthday);
                let year = today.getFullYear() - age.getFullYear();
                let month = today.getMonth() - age.getMonth();
                if (month < 0) {
                    month +=12;
                    year -= 1;
                }
                return [year, month];
            }

            function remainsToPension(gender, age){
                const [year, month] = age;
                const months = gender === 'm' ? 64*12 : 59*12;
                const remainsMonth = months - year*12 + month;
                if (remainsMonth < 0){
                    return [null, null];
                }
                if (remainsMonth % 12 === 0) {
                   return [remainsMonth/12 + 1, 0];
                }
                return [Math.floor(remainsMonth/12), 12 - remainsMonth % 12];
            }

            function newFormatofBirthday (birthday, months){
                const tempDate = new Date(birthday);
                return `${tempDate.getDate()}.${months[tempDate.getMonth()][1]}.${tempDate.getFullYear()}`;
            }

            function ageCase (age) {
                if ((age%10 == 1) && (age%100 != 11)) {
                    return 'год';
                }
                if ((age%10 == 2 || age%10 == 3 ||  age%10 == 4) && (age%100 != 12 || age%100 != 13 || age%100 != 14)) {
                    return 'года';
                }
                return 'лет';
                
            }
            const months = [
                ['Январь', 'января'],
                ['Февраль', 'февраля'],
                ['Март', 'марта'],
                ['Апрель', 'апреля'],
                ['Май', 'мая'],
                ['Июнь', 'июня'],
                ['Июль', 'июля'],
                ['Август', 'августа'],
                ['Сентябрь', 'сентября'],
                ['Октябрь', 'октября'],
                ['Ноябрь', 'ноября'],
                ['Декабрь', 'декабря'],
            ];


            let table = `<table><thead>
                <tr>
                    <th>№</th>
                    <th>ФИО</th> 
                    <th>Дата рождения</th> 
                    <th>Возраст</th> 
                    <th>Зарплата гросс.</th>   
            `;
            for(let i = 0; i < 12; i++) {
                table += `<th>${months[i][0]}</th>`;
            }
            table += `<th>Зарплата в ${new Date().getFullYear()+1} году</th>
                <th>Общий доход</th>
                <th>К вычету</th>
                <th>Ост. до пенсии</th>
            </tr>
            </thead>
            <tbody>
            `;
            const rub = "&#x20bd";
            
            for(let i in employees) {
                item = employees[i];
                [ageYear, ageMonth] = calculateAge(item.birthday);
                [rtpYear, rtpMonth] = remainsToPension(item.gender, [ageYear, ageMonth]);

                table += `<tr>
                    <td>${+i+1}</td>
                    <td>${item.surname} ${item.name} ${item.patronymic}</td>
                    <td>${newFormatofBirthday(item.birthday, months)}</td>
                    <td>${ageYear} ${ageCase(ageYear)}</td>
                    <td>${item.salary}${rub}</td>`;
                let ys = calculateYearSalary(item.salary, item.salary13);
                for (let j = 0; j < 11; j++) {
                    table += `<td ${j===item.vacation ? 'class="vacation"' : ''}>${calculateNetSalary(item.salary)}${rub}</td>`;
                }
                table += `<td ${11===item.vacation ? 'class="vacation"' : ''}>${calculateNetSalary(item.salary)+calculateNewSalary(item.salary13)}${rub}</td>
                <td>${calculateNewSalary(item.salary)}${rub}</td>
                <td>${ys}${rub}</td>
                <td>${calculateTaxReturn(ys)}${rub}</td>
                <td>${rtpYear !== null ? (rtpYear + ageCase(rtpYear)) : "Уже на пенсии"}</td>
                `;
                table += `</tr>`;
            }

            table += `</tbody></table>`;
            window.onload = () => {
                document.querySelector("#wrapper").innerHTML = table;

                document.querySelector("#create").onclick = (e) => {
                    e.preventDefault();
                    let newWin = window.open("about:blank", "Дневник", "width=420,height=594");
                    let template = `
                    <style>
                        body {
                            margin-top: 100px;
                            text-align: center;
                            font-size: large;
                            background-color: ${document.querySelector('[name="color"').value}
                        }
                        .contact {
                            margin-top: 50px;
                        }
                    </style>
                    <h1>Дневник</h1>
                    <div>Учени${document.querySelector('[name="pol"]:checked').value == "male" ? "ка" : "цы"} ${document.querySelector('[name="class"]').value} класса</div>
                    <div>${document.querySelector('[name="school"]').value} ${document.querySelector('[name="city"]').value}</div>
                    <div>${document.querySelector('[name="fio"]').value}</div>
                    <div>${document.querySelector('[name="year"]').value}/${+document.querySelector('[name="year"]').value+1} учебного года</div>
                    <div class='contact'>${document.querySelector('[name="email"]').value}, ${document.querySelector('[name="tel"]').value}</div>
                    `;
                    newWin.document.write(template);
                }
            }
        </script>              
    </div>   
</body>
</html>